---
const navItems = [
  {
    name: 'Solutions',
    href: '/solutions',
    dropdown: [
      { name: 'Platform Engineering', href: '/solutions/platform-engineering' },
      { name: 'DevSecOps & Security', href: '/solutions/devsecops' },
      { name: 'Cloud Migration', href: '/solutions/cloud-migration' },
      { name: 'Managed Operations', href: '/solutions/managed-ops' },
      { name: 'AI Ops & Intelligent Automation', href: '/solutions/ai-ops' },
    ]
  },
  { name: 'Case Studies', href: '/case-studies' },
  { name: 'About', href: '/about' },
  { name: 'How We Work', href: '/approach' },
  { name: 'Contact', href: '/contact' },
];
---

<header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
  <div class="absolute inset-0 bg-midnight/80 backdrop-blur-xl border-b border-white/5 opacity-0 transition-opacity duration-300" id="header-bg"></div>

  <nav class="container-custom relative">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center group">
        <img src="/logo.png" alt="catdev" class="h-12 w-auto" />
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-8">
        {navItems.map((item) => (
          item.dropdown ? (
            <div class="relative group">
              <button
                class="flex items-center gap-1 text-steel hover:text-white transition-colors duration-200 text-sm font-medium"
              >
                {item.name}
                <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>

              <!-- Dropdown Menu -->
              <div class="absolute top-full left-0 mt-2 w-56 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                <div class="bg-deep-space/95 backdrop-blur-xl border border-white/10 rounded-lg shadow-xl p-2">
                  {item.dropdown.map((subItem) => (
                    <a
                      href={subItem.href}
                      class={`block px-4 py-3 text-sm rounded-lg transition-colors ${
                        subItem.highlight
                          ? 'text-cyan hover:bg-cyan/10 font-semibold border-t border-white/10 mt-2 pt-3'
                          : 'text-steel hover:text-white hover:bg-white/5'
                      }`}
                    >
                      {subItem.name}
                    </a>
                  ))}
                </div>
              </div>
            </div>
          ) : (
            <a
              href={item.href}
              class="text-steel hover:text-white transition-colors duration-200 text-sm font-medium"
            >
              {item.name}
            </a>
          )
        ))}
      </div>

      <!-- CTA Button -->
      <div class="hidden md:block">
        <a href="/contact" class="btn-primary text-sm py-3 px-6">
          Book Architecture Review
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="md:hidden relative w-10 h-10 flex items-center justify-center"
        aria-label="Toggle menu"
      >
        <div class="flex flex-col gap-1.5" id="hamburger">
          <span class="w-6 h-0.5 bg-white transition-all duration-300 origin-center"></span>
          <span class="w-6 h-0.5 bg-white transition-all duration-300"></span>
          <span class="w-6 h-0.5 bg-white transition-all duration-300 origin-center"></span>
        </div>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="fixed inset-0 bg-midnight/95 backdrop-blur-xl z-40 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300 md:hidden"
  >
    <nav class="flex flex-col items-center gap-6 max-h-screen overflow-y-auto py-20">
      {navItems.map((item, index) => (
        item.dropdown ? (
          <div class="flex flex-col items-center gap-4">
            <span class="text-2xl font-bold text-white mobile-nav-item" style={`transition-delay: ${index * 50}ms`}>
              {item.name}
            </span>
            <div class="flex flex-col items-center gap-2">
              {item.dropdown.filter(sub => !sub.highlight).map((subItem, subIndex) => (
                <a
                  href={subItem.href}
                  class="text-lg text-steel hover:text-cyan transition-colors mobile-nav-item"
                  style={`transition-delay: ${(index * 50) + (subIndex * 30)}ms`}
                >
                  {subItem.name}
                </a>
              ))}
            </div>
          </div>
        ) : (
          <a
            href={item.href}
            class="text-3xl font-bold text-white hover:text-cyan transition-colors mobile-nav-item"
            style={`transition-delay: ${index * 50}ms`}
          >
            {item.name}
          </a>
        )
      ))}
      <a href="/contact" class="btn-primary mt-4 mobile-nav-item" style={`transition-delay: ${navItems.length * 50}ms`}>
        Book Architecture Review
      </a>
    </nav>
  </div>
</header>

<script>
  const header = document.getElementById('header');
  const headerBg = document.getElementById('header-bg');
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburger = document.getElementById('hamburger');

  let isMenuOpen = false;

  // Header background on scroll
  const handleScroll = () => {
    if (window.scrollY > 50) {
      headerBg?.classList.remove('opacity-0');
      headerBg?.classList.add('opacity-100');
    } else {
      headerBg?.classList.add('opacity-0');
      headerBg?.classList.remove('opacity-100');
    }
  };

  window.addEventListener('scroll', handleScroll);

  // Mobile menu toggle
  mobileMenuBtn?.addEventListener('click', () => {
    isMenuOpen = !isMenuOpen;

    if (isMenuOpen) {
      mobileMenu?.classList.remove('opacity-0', 'pointer-events-none');
      mobileMenu?.classList.add('opacity-100', 'pointer-events-auto');
      document.body.style.overflow = 'hidden';

      // Animate hamburger to X
      const spans = hamburger?.querySelectorAll('span');
      if (spans) {
        spans[0].style.transform = 'rotate(45deg) translate(4px, 4px)';
        spans[1].style.opacity = '0';
        spans[2].style.transform = 'rotate(-45deg) translate(4px, -4px)';
      }
    } else {
      mobileMenu?.classList.add('opacity-0', 'pointer-events-none');
      mobileMenu?.classList.remove('opacity-100', 'pointer-events-auto');
      document.body.style.overflow = '';

      // Reset hamburger
      const spans = hamburger?.querySelectorAll('span');
      if (spans) {
        spans[0].style.transform = '';
        spans[1].style.opacity = '1';
        spans[2].style.transform = '';
      }
    }
  });

  // Close menu on link click
  mobileMenu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      isMenuOpen = false;
      mobileMenu?.classList.add('opacity-0', 'pointer-events-none');
      mobileMenu?.classList.remove('opacity-100', 'pointer-events-auto');
      document.body.style.overflow = '';

      const spans = hamburger?.querySelectorAll('span');
      if (spans) {
        spans[0].style.transform = '';
        spans[1].style.opacity = '1';
        spans[2].style.transform = '';
      }
    });
  });
</script>
