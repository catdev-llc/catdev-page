---
import Layout from '../../layouts/Layout.astro';
import CTASection from '../../components/shared/CTASection.astro';
import { caseStudies } from '../../data/caseStudies';

// Get unique industries and solution types for filters
const industries = [...new Set(caseStudies.map(cs => cs.industry))];
const solutionTypes = ['platform-engineering', 'devsecops', 'cloud-migration', 'managed-ops'];
const solutionTypeLabels: Record<string, string> = {
  'platform-engineering': 'Platform Engineering',
  'devsecops': 'DevSecOps & Security',
  'cloud-migration': 'Cloud Migration',
  'managed-ops': 'Managed Operations',
};
---

<Layout
  title="Case Studies"
  description="Real platforms, real results. See how we've delivered secure, scalable delivery platforms for startups, SaaS companies, and financial institutions."
>
  <!-- Hero Section -->
  <section class="section-padding bg-midnight relative overflow-hidden pt-32">
    <div class="container-custom">
      <div class="text-center max-w-4xl mx-auto mb-16 reveal">
        <h1 class="text-4xl md:text-6xl font-bold mb-6">
          Real Platforms, <span class="text-gradient">Real Results</span>
        </h1>
        <p class="text-xl md:text-2xl text-steel mb-8">
          From startups to banksâ€”here's how we've built secure, scalable delivery platforms for teams that ship.
        </p>
      </div>
    </div>
  </section>

  <!-- Filters -->
  <section class="py-8 relative">
    <div class="container-custom">
      <div class="flex flex-wrap items-center gap-4 justify-center">
        <span class="text-steel text-sm font-semibold uppercase tracking-wider">Filter by:</span>

        <!-- All Filter -->
        <button
          class="filter-btn active"
          data-filter="all"
        >
          All
        </button>

        <!-- Industry Filters -->
        {industries.map(industry => (
          <button
            class="filter-btn"
            data-filter={`industry:${industry}`}
          >
            {industry}
          </button>
        ))}

        <!-- Solution Type Filters -->
        {solutionTypes.map(type => (
          <button
            class="filter-btn"
            data-filter={`solution:${type}`}
          >
            {solutionTypeLabels[type]}
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Case Studies Grid -->
  <section class="section-padding relative">
    <div class="container-custom">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8" id="case-studies-grid">
        {caseStudies.map((study, index) => (
          <div
            class="case-study-card card-glass p-8 reveal"
            style={`transition-delay: ${index * 100}ms`}
            data-industry={study.industry}
            data-solutions={study.solutionTypes.join(',')}
          >
            <div class="glow-effect"></div>
            <div class="relative z-10">
              <!-- Header -->
              <div class="flex items-start justify-between gap-4 mb-4">
                <div class="inline-block px-3 py-1 bg-cyan/10 border border-cyan/30 rounded-full text-cyan text-xs font-semibold uppercase tracking-wider">
                  {study.clientType}
                </div>
                <span class="text-steel/60 text-xs">{study.industry}</span>
              </div>

              <h3 class="text-2xl md:text-3xl font-bold text-white mb-4">
                {study.title}
              </h3>

              <!-- Problem -->
              <div class="mb-6">
                <h4 class="text-electric font-semibold mb-2 flex items-center gap-2 text-sm">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                  </svg>
                  The Challenge
                </h4>
                <p class="text-steel text-sm leading-relaxed line-clamp-3">
                  {study.problem}
                </p>
              </div>

              <!-- Results -->
              <div class="mb-6">
                <h4 class="text-green-400 font-semibold mb-3 flex items-center gap-2 text-sm">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                  </svg>
                  Key Results
                </h4>
                <ul class="space-y-2">
                  {study.outcome.slice(0, 3).map(result => (
                    <li class="flex items-start gap-2 text-white text-sm">
                      <svg class="w-3 h-3 text-green-400 flex-shrink-0 mt-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                      </svg>
                      <span>{result}</span>
                    </li>
                  ))}
                </ul>
              </div>

              <!-- Technologies -->
              <div class="mb-6">
                <div class="flex flex-wrap gap-2">
                  {study.technologies.slice(0, 6).map(tech => (
                    <span class="px-2 py-1 bg-white/5 border border-white/10 rounded text-steel text-xs font-mono">
                      {tech}
                    </span>
                  ))}
                  {study.technologies.length > 6 && (
                    <span class="px-2 py-1 text-steel/60 text-xs">+{study.technologies.length - 6} more</span>
                  )}
                </div>
              </div>

              <!-- CTA -->
              <a
                href={`/case-studies/${study.slug}`}
                class="btn-secondary w-full justify-center"
              >
                Read Full Story
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
              </a>
            </div>
          </div>
        ))}
      </div>

      <!-- No Results Message -->
      <div id="no-results" class="hidden text-center py-20">
        <p class="text-xl text-steel mb-4">No case studies match your filters.</p>
        <button
          class="btn-secondary"
          onclick="document.querySelector('[data-filter=all]').click()"
        >
          Clear Filters
        </button>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <CTASection
    headline="Need similar results?"
    subheadline="Book a free architecture review and we'll show you what a production-grade platform looks like."
    primaryCTA={{
      text: 'Book Architecture Review',
      href: '/contact'
    }}
    secondaryCTA={{
      text: 'Explore Solutions',
      href: '/solutions'
    }}
  />
</Layout>

<style>
  .filter-btn {
    @apply px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200;
    @apply bg-white/5 border border-white/10 text-steel;
    @apply hover:bg-white/10 hover:text-white hover:border-white/20;
  }

  .filter-btn.active {
    @apply bg-cyan/20 border-cyan/50 text-cyan;
  }

  .case-study-card {
    transition: all 0.3s ease;
  }

  .case-study-card.hidden {
    display: none;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

<script>
  // Filter functionality
  const filterButtons = document.querySelectorAll('.filter-btn');
  const caseStudyCards = document.querySelectorAll('.case-study-card');
  const noResults = document.getElementById('no-results');

  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const filter = button.getAttribute('data-filter');

      // Update active state
      filterButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');

      // Filter cards
      let visibleCount = 0;

      caseStudyCards.forEach(card => {
        const industry = card.getAttribute('data-industry');
        const solutions = card.getAttribute('data-solutions')?.split(',') || [];

        let shouldShow = false;

        if (filter === 'all') {
          shouldShow = true;
        } else if (filter?.startsWith('industry:')) {
          const filterIndustry = filter.replace('industry:', '');
          shouldShow = industry === filterIndustry;
        } else if (filter?.startsWith('solution:')) {
          const filterSolution = filter.replace('solution:', '');
          shouldShow = solutions.includes(filterSolution);
        }

        if (shouldShow) {
          card.classList.remove('hidden');
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });

      // Show/hide no results message
      if (visibleCount === 0) {
        noResults?.classList.remove('hidden');
      } else {
        noResults?.classList.add('hidden');
      }
    });
  });
</script>
